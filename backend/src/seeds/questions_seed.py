"""Seed script to import questions from markdown files into the database.

Run with: python -m src.seeds.questions_seed
"""

import asyncio
from decimal import Decimal
from uuid import uuid4

from sqlalchemy.ext.asyncio import AsyncSession

from src.core.database import async_session_factory
from src.models.question import Question
from src.models.question_group import QuestionGroup
from src.models.question_option import QuestionOption
from src.models.questionnaire_type import QuestionnaireType
from src.models.enums import OptionType, ScoringMethod


# Seed data parsed from questions/*.md files
SEED_DATA = [
    {
        "name": "ГАЛЫН АЮУЛГҮЙ БАЙДАЛ",
        "groups": [
            {
                "name": "Галын хор",
                "questions": [
                    "Лац түгжээ, шаланк, резин жийрэг нь бүрэн бүтэн эсэх",
                    "Монометр нь ногоон түвшинг зааж байгаа эсэх",
                    "Галын хорыг сүүлийн 6 сарын дотор туршиж үзсэн эсэх",
                    "Галын хорын ангилал нь тухайн байгууламжинд тохирох эсэх",
                    "Галын хорын тэмдэг, тэмдэглэгээ байгаа эсэх",
                ],
            },
            {
                "name": "Галд шатах материал",
                "questions": [
                    "Галд шатах материалууд дийлэнх хувийг эзэлдэг эсэх",
                    "Шатах материалыг 3 метрээс дээш өндөрт хураасан эсэх",
                    "Цахилгааны залгуур, өндөр хүчдэлийг налуулан бараа материал хураасан эсэх",
                    "Тухайн бараа материал, үхэлд хүргэх химийн хорт хий ялгаруулдаг эсэх",
                    "Тухайн бараа материал галд тэсвэргүй, хурдан шатамхай эсэх",
                ],
            },
            {
                "name": "Цахилгааны гал",
                "questions": [
                    "Цахилгааны шитийн утаснууд эмх цэгцтэй стандартын дагуу суурилагдсан эсэх",
                    "Цахилгаан утаснууд тоос шороонд их дарагдсан эсэх",
                    "Хуваарилах байгууламж гэрэлтүүлэг, тэмдэг тэмдэглэгээ, газардуулгын акттай эсэх",
                    "Хуваарилах самбарын утаснууд харлаагүй, масслаагүй, шатаагүй, орооцолдоогүй эсэх",
                    "Цахилгаан самбарын толгой автоматыг унахуйц ампер суурилуулсан эсэх",
                ],
            },
            {
                "name": "Цахилгаан утас",
                "questions": [
                    "Нэг залгуураас 3 болон түүнээс дээш залгуур эх сурвалж авсан эсэх",
                    "Цахилгаан розетик хананаас мултарсан, ил гарсан, бүрхүүл нь хагарсан эсэх",
                    "Гадна талын цахилгаан утасны найдвартай байдлыг бүрэн хангасан эсэх",
                    "Цахилгааны пускатель байгаа эсэх",
                    "Доторх цахилгаан утаснууд эмх цэгцтэй монтажлагдсан эсэх",
                ],
            },
            {
                "name": "Галын дотоод хяналт",
                "questions": [
                    "Галын утаа мэдрэгчтэй эсэх",
                    "Галаас урьдчилан сэргийлэх санамжуудтай эсэх",
                    "Анхан шатны багаж хэрэгсэл бүрэн бүтэн эсэх",
                    "Галын аюулгүй байдлыг хангах дотоод журамтай эсэх",
                    "Ажилтнууд галын хорыг ашиглаж сурсан эсэх",
                ],
            },
        ],
    },
    {
        "name": "ЦАХИЛГААНЫ АЮУЛГҮЙ БАЙДАЛ",
        "groups": [
            {
                "name": "Хэрэглэгчийн үүрэг хариуцлага",
                "questions": [
                    "Мэргэшсэн үнэмлэхтэй цахилгаан техникийн мэргэжлийн ажилтантай эсэх",
                    "Цахилгааны урсгал засварыг цаг тухайд нь хийдэг эсэх",
                    "Цахилгаан тоног төхөөрөмжийн ашиглалтын үед осол гэмтэл гарсан эсэх",
                    "Цахилгаан тоног төхөөрөмж хамгаалах хэрэгслээр бүрэн хангагдсан эсэх",
                    "Цахилгаан техникийн ажилтны ашиглалтын зааврыг боловсруулсан эсэх",
                ],
            },
            {
                "name": "Хувиарлах байгууламж",
                "questions": [
                    "Хувиарлах байгууламж нь байнгын газардуулгаар тоноглогдсон эсэх",
                    "Хувиарлах самбарын кабель утас нь тэмдэглэгээтэй эсэх",
                    "Хувиарлах самбарын кабель утас эмх цэгцтэй монтажлагдсан эсэх",
                    "Холбогдох мэргэжилтэнгүүд аваарын үед ажиллах схем, заавруудаар хангагдсан эсэх",
                    "Хувиарлах байгууламжийн засвар үйлчилгээг тогтоосон хугацаанд хийсэн эсэх",
                ],
            },
            {
                "name": "Трансформаторын техник ашиглалт",
                "questions": [
                    "Ректоруудад дэд станцын дугаар, диспетчерийн нэр бичигдсэн эсэх",
                    "Хөргөлтийн т/т-н хөдөлгүүрийн тэжээлийн эх үүсвэр автоматаар залгагддаг эсэх",
                    "Ачаалалтай трансформаторын хүчдэл тохируулагч нь байнгын ажиллагаатай эсэх",
                    "Ректорын их урсгал засварыг тогтоосон хугацаанд хийсэн эсэх",
                    "Ашиглалтад байгаа трансформаторын эд анги, туршилтыг нормын дагуу хийж гүйцэтгэсэн эсэх",
                ],
            },
            {
                "name": "Цахилгаан дамжуулах агаарын шугам",
                "questions": [
                    "Агаарын шугам нь бусад агаарын шугамтай огтлолцсон эсэх",
                    "Агаарын шугаман утасны холбоос шаардлага хангасан эсэх",
                    "Агаарын шугаман тулгууруудад санамж плакатууд бүрэн тавигдсан эсэх",
                    "Тулгуур болон металл хийцийг зэврэлтээс хамгаалах түрхлэг хийсэн эсэх",
                    "Агаарын шугаманд ээлжит болон ээлжит бус үзлэг хийгддэг эсэх",
                ],
            },
            {
                "name": "Реле, газардуулах диспетчер",
                "questions": [
                    "Реле хамгаалалт, автоматик ба хоёрдогч хэлхээнд хэмжилт, туршилт тохируулга хийгдсэн эсэх",
                    "Газардуулгын утсыг холбохдоо гагнуураар буюу боолтоор холболтыг хийсэн эсэх",
                    "Зэврэлтээс хамгаалсан эсэргүйцлийн хэмжилтийг тогтоосон хугацаанд хийсэн эсэх",
                    "Диспетчерийн шуурхай удирдлага, албатай эсэх",
                    "Цахилгаан хангамжийн системтэй, хэмжилттэй горимыг хангаж ажилладаг эсэх",
                ],
            },
        ],
    },
    {
        "name": "ХӨДӨЛМӨРИЙН АЮУЛГҮЙ БАЙДАЛ",
        "groups": [
            {
                "name": "Барилга угсралтын талбай",
                "questions": [
                    "Талбайн зохион байгуулалтын зурагтай эсэх",
                    "Барилга угсралтын талбайн аюулгүй ажиллагааны зохицуулагч ажлуулдаг эсэх",
                    "Хамгаалах тор, хашлага анхааруулах зурвас татах журам түүний хэрэгжилтийг хангуулдаг эсэх",
                    "Ажилтнууд, тээврийн хэрэгсэл, өргөх зөөх механизмийн талбайн хязгаарлалт тэмдэглэгээтэй эсэх",
                    "Гарах өргөх ачааны зөвшөөрөгдөх хэмжээг мөрддөг эсэх",
                ],
            },
            {
                "name": "Машин механизм, тоног төхөөрөмж",
                "questions": [
                    "Машин механизм, тоног төхөөрөмжийн зай аюулгүй ажиллагааны шаардлага хангасан эсэх",
                    "Машин механизм, тоног төхөөрөмж ажиллуулах үед мөрдөх аюулгүй ажилгааны заавартай эсэх",
                    "Тоног төхөөрөмж удирдлага нь бүрэн ажилладаг эсэх",
                    "Ажлын байранд тоног төхөөрөмжийн аюулгүй бүсийг тогтоосон эсэх",
                    "Т/т-н засвар, үйлчилгээ тохируулгыг техникийн баримт бичигт заасан хугацаанд тогтмол хийдэг эсэх",
                ],
            },
            {
                "name": "Өргөх, зөөх, тээвэрлэх механизм",
                "questions": [
                    "Өргөх зөөх хэрэгслийн техникийн аюулгүй байдлыг хариуцсан ажилтантай эсэх",
                    "Мэргэжлийн оосорлогч дохиотой эсэх",
                    "Даацын баталгааг мэргэжлийн байгууллагаар хийлгэсэн эсэх",
                    "Тоормазны механизм бүрэн ажилладаг эсэх",
                    "Өргөх дэгээ түгжээний аваарын таслууртай эсэх",
                ],
            },
            {
                "name": "Газрын дор хязгаарлагдмал орчин",
                "questions": [
                    "Холбоо барих хэрэгсэлтэй эсэх",
                    "Ажилд оруулах зөвшөөрөл олгодог эсэх",
                    "Агааржуулалтын системтэй эсэх",
                    "Аваарын үед ажиллах журамтай эсэх",
                    "Ажлыг хянах хянагчтай эсэх",
                ],
            },
            {
                "name": "Химийн бодис",
                "questions": [
                    "Химийн бодисыг хадгалах, ашиглах журам, санамж шошигтой эсэх",
                    "Химийн бодисыг стандартын нөхцөлд хадгалдаг эсэх",
                    "Химийн бодис ашиглалтын болон аюулгүй ажиллагааны заавартай эсэх",
                    "Химийн бодисыг мэдээллэх хуудас ашигладаг, тэмдэглэл хөтөлдөг эсэх",
                    "Химийн тусгай лабортортой эсэх",
                ],
            },
        ],
    },
    {
        "name": "ТЭЭВРИЙН ХЭРЭГСЭЛ ТЕХНИКИЙН АЮУЛГҮЙ БАЙДАЛ",
        "groups": [
            {
                "name": "Тоормосны систем",
                "questions": [
                    "Тоормосны зам, дугуй бүрийн тоормосны жигд барилт, тэдгээрийн зөрүүг шалгадаг эсэх",
                    "Хий ба шингэн удирдлагатай тоормосны системийн битүүмжийн байдалд үзлэг шалгалт хийдэг эсэх",
                    "Дөрөөний сул ба бүрэн явалтыг шалгадаг эсэх",
                    "Зогсоолын тоормосны идэвхжилтийг шалгадаг эсэх",
                    "Хөдөлгүүрийн ажилласан хийн найрлагыг шалгадаг эсэх",
                ],
            },
            {
                "name": "Жолооны механизм",
                "questions": [
                    "Жолооны хүрдний сул ба бүрэн явалтыг болон эргүүлэх хүчийг хэмжиж шалгадаг эсэх",
                    "Жолооны араат дамжуулга дахь шингэнт хүчлүүрийн битүүмжлэл шалгадаг эсэх",
                    "Жолооны удирдлагын татуурга, нугасан холбоос, нударганы сул явалтыг хэмжиж шалгадаг эсэх",
                    "Урд тэнхлэгийн өндрийг хэмжиж, шалгадаг эсэх",
                    "Дуу намсгагч болон дуу чимээний түвшинг үзэж шалгадаг эсэх",
                ],
            },
            {
                "name": "Гэрэлтүүлэгч цахилгааны систем",
                "questions": [
                    "Их гэрлийн тусгалын тохиргоо, гэрлийн хүчийг хэмжиж шалгадаг эсэх",
                    "Хурд хэмжүүр, дуут дохионы ажиллагааг шалгадаг эсэх",
                    "Гэрлэн дохио, гэрэл ойлгуурын иж бүрдэл болон гэрэл шилжүүгийн ажиллагааг шалгадаг",
                    "Цахилгаан дамжуулах утасны бүрэн бүтэн байдалд үзлэг хийдэг эсэх",
                    "Авто машины оврын гэрлүүд цацруулагч гэрлийн хүрээний бүрэн байдалд үзлэг хийдэг эсэх",
                ],
            },
            {
                "name": "Хөдөлгүүрийн хүч дамжуулах анги",
                "questions": [
                    "Дискэн холбоо салахгүй буюу хий эргэдэг эсэхэд үзлэг хийдэг эсэх",
                    "Гордон галын дамжуулгын байдалд үзлэг хийдэг эсэх",
                    "Хөдөлгүүр хурдны хайрцаг ерөнхий дамжуулгаас тос, хөргөх системээс шингэн гоожсон эсэх",
                    "Сэнсний оосорын элэгдэл, тохиргоо гэмтэлтэй эсэх",
                    "Хурдны хайрцгийн дамжуулгын байдалд үзлэг хийдэг эсэх",
                ],
            },
            {
                "name": "Ерөнхий байдал",
                "questions": [
                    "Шил толины бүрэн бүтэн байдалд үзлэг хийдэг эсэх",
                    "Дулаан, агааржуулалт, салхижуулалтын систем ажиллагаатай эсэх",
                    "Кузовын бэхэлгээ, аюулгүйн тулгуурыг үзэн шалгадаг эсэх",
                    "Шил алчуур, шил угаагуур болон үлээгүүрийн ажиллагааг шалгадаг эсэх",
                    "Салхины шилний үзэгдэх орчныг хязгаарлах байдалд үзлэг хийдэг эсэх",
                ],
            },
        ],
    },
    {
        "name": "АГУУЛАХЫН АЮУЛГҮЙ БАЙДАЛ",
        "groups": [
            {
                "name": "Агуулах зоорийн доторхи орчин",
                "questions": [
                    "Агуулахын хаалга, цонх нь шувуу, ургамлын хортон шавьж нэвтрэхгүй байхаар битүүмжлэгдсэн эсэх",
                    "Агуулахын чийглэг, температур шаардлага хангасан эсэх",
                    "Агааржуулалтын систем хэвийн ажилладаг эсэх",
                    "Шал, ханыг плитадсан эсвэл цементэлсэн эсэх",
                    "Агуулахын дотор, гаднах өнгө үзэмж сайтай эсэх",
                ],
            },
            {
                "name": "Агуулах зоорийн гадна орчин",
                "questions": [
                    "Гадна талдаа гэрэлтүүлэгтэй, хашаагаар хамгаалагдсан эсэх",
                    "Гадна талбайн хог, ургамалыг устгасан эсэх",
                    "Аюулгүйн тэмдэг, галын гарц заасан тэмдэглэгээтэй эсэх",
                    "Хог хаягдалын цэгтэй, бүх хог хаягдалыг цэвэрлэдэг эсэх",
                    "Гал түймрийн хэрэгсэл байрлуулсан эсэх",
                ],
            },
            {
                "name": "Бүтээгдэхүүнд хийх үзлэг",
                "questions": [
                    "Бүтээгдэхүүнд элдэв гадны хольц, шавьж байхгүй эсэх",
                    "Бүтээгдэхүүнийг зориулалтын тээврийн хэрэгслэлээр тээвэрлэдэг эсэх",
                    "Хадгалж буй бүтээгдхүүнийг хаягжуулсан эсэх",
                    "Сав баглаа боодол стандартад нийцсэн эсэх",
                    "Савласан бүтээгдэхүүн шошгололт стандартын шаардлага хангасан эсэх",
                ],
            },
            {
                "name": "Бүтээгдэхүүний чанар",
                "questions": [
                    "Хадгалж борлуулж буй бүтээгдэхүүн гарал үүслийн гэрчилгээтэй эсэх",
                    "Хүний эрүүл мэндэд хор нөлөөгүй талаар эрх бүхий байгууллагын дүгнэлттэй эсэх",
                    "Хүнсний түүхий эд, бүтээгдэхүүний ул мөрийг мөрдөн тогтоох бүртгэлийг хөтөлсөн эсэх",
                    "Агуулах зооринд халдваргүйжүүлэлт хийх гэрээ байгуулсан эсэх",
                    "Халдваргүйтэл ариутгал хийлгэсэн тухай акттай эсэх",
                ],
            },
            {
                "name": "Дотоод хяналт",
                "questions": [
                    "Температур, чийг хэмжилтийг өдөр бүр хийж тэмдэглэл хөтөлдөг эсэх",
                    "Дотоод хяналт шалгалтын нэгж ажиллагаатай эсэх",
                    "Утаа мэдрэгч, галын дохиоллын системтэй эсэх",
                    "Эрүүл ахуйн шаардлага хангасан гар угаах болон угаалгын өрөөтэй эсэх",
                    "Галын хор, анхны тусламжийн эмийн сан, саармагжуулалтын бодистой эсэх",
                ],
            },
        ],
    },
    {
        "name": "ТОНОГ ТӨХӨӨРӨМЖИЙН АЮУЛГҮЙ БАЙДАЛ",
        "groups": [
            {
                "name": "Гэмтэх, зүсэгдэх, хатгагдах",
                "questions": [
                    "Үс гэзэг, хувцас хэрэгсэл хөдөлгөөнтэй эргэлдэх төхөөрөмжид орооцолдох магадлалтай эсэх",
                    "Төхөөрөмжийг удаашруулан зогсоох, хөдөлгөөнийг хязгаарлах нөхцлөөр хомсдолтой эсэх",
                    "Төхөөрөмжийг шалгах, засварлах, цэвэрлэгээ хийх явцад хөдөлгөөнт эд ангитай шүргэлцэх эсэх",
                    "Төхөөрөмж, материал болон хөдөлгөөнгүй эд зүйлийн дунд гацах магадлалтай эсэх",
                    "Хурц иртэй болон шидэгдсэн биеттэй шүргэлцэх магадлалтай эсэх",
                ],
            },
            {
                "name": "Тайрагдах, түлэгдэх, цохигдох",
                "questions": [
                    "Төхөөрөмжийн гадаргуу, эсхүл уг төхөөрөмжид ашиглаж буй материалтай шүргэлдсэнээс түлэгдэх эсэх",
                    "Төхөөрөмжийн эд ангиудын хооронд, эсхүл бүтэц, хийцийн хооронд хүний эд эрхтэн орж тайрагдах эсэх",
                    "Төхөөрөмж түүний эд анги бэлдэц бүтэц задрах, сугарах магадлалтай эсэх",
                    "Төхөөрөмжид ашиглаж буй материалын гэнэтийн, хяналтаас гадуур хөдөлгөөнтэй эсэх",
                    "Төхөөрөмжийн гэмтэл, буруу ажиллуулснаас шалтгаалан өндөр даралтад шингэнд өртөх аюул бий эсэх",
                ],
            },
            {
                "name": "Хальтрах, бүдрэх, амьсгал боогдох",
                "questions": [
                    "Төхөөрөмжийн ойролцоо саад учруулахуйц зүйл олон эсэх",
                    "Ажлын гадаргуу тэгш бус хальтаргаатай, орчны цэвэр байдал хангагдаагүй эсэх",
                    "Тохирох ажлын тавцан, шат, хайс, хашилт хальтрахаас хамгаалсан гадаргуу хүрэлцээтэй эсэх",
                    "Бөглөөгүй нүх, цоорхой завсар, явах хэсэг хазгай эсэх",
                    "Агаар бохирдох, хүчилтөрөгч дутах шалтгаанаар амьсгал боогдох магадлалтай эсэх",
                ],
            },
            {
                "name": "Гар ажиллагаа",
                "questions": [
                    "Зөөж буй обьектын байдал, хэмжээ, хэлбэр, хийц, ирмэг гулсамтгай, барьцгүй тогтворгүй эсэх",
                    "Ажлын байрны зохион байгуулалтын нөхцөл муу эсэх",
                    "Гар ажиллагааны зарцуулах хүч, үргэлжлэх хугацаа, давтамж, хоромхон зуур ядраах сульдаах эсэх",
                    "Гар ажиллагааг гүйцэтгэхэд нас, ур чадвар, туршлага шаарддаг эсэх",
                    "Обьектыг зөөх зай урт, хугацаа шаарддаг, механик туслалцаа дутмаг эсэх",
                ],
            },
            {
                "name": "Цахилгаан холболт, дэлбэрэлт",
                "questions": [
                    "Төхөөрөмж цахилгаан дамжуулагчтай шүргэлцсэн эсхүл хэт ойр байрласан эсэх",
                    "Цахилгаан хэрэгсэл усны ойр байрласан, тусгаарлах арга ажиллагаа хяналтгүй эсэх",
                    "Материалын улмаас үүсэх хий, ууршилт, тоос бусад бодисын дэлбэрэлтэд өртөх аюултай эсэх",
                    "Хэт нам ба өндөр температурт орчинд ажилласнаас хүний эрүүл мэндэд сөрөг нөлөөтэй эсэх",
                    "Цахилгааны хэлхээ хэт ачаалалтай, хэлхээний залгуур гэмтэлтэй эсэх",
                ],
            },
        ],
    },
]


async def seed_questions(session: AsyncSession) -> dict:
    """Seed all question types, groups, and questions.

    Returns:
        Dict with counts of created entities.
    """
    stats = {"types": 0, "groups": 0, "questions": 0, "options": 0}

    for type_order, type_data in enumerate(SEED_DATA, start=1):
        # Create QuestionnaireType
        qtype = QuestionnaireType(
            id=uuid4(),
            name=type_data["name"],
            scoring_method=ScoringMethod.SUM,
            threshold_high=80,
            threshold_medium=50,
            weight=Decimal("1.0"),
            is_active=True,
        )
        session.add(qtype)
        await session.flush()
        stats["types"] += 1
        print(f"Created Type: {qtype.name}")

        for group_order, group_data in enumerate(type_data["groups"], start=1):
            # Create QuestionGroup
            group = QuestionGroup(
                id=uuid4(),
                type_id=qtype.id,
                name=group_data["name"],
                display_order=group_order,
                weight=Decimal("1.0"),
                is_active=True,
            )
            session.add(group)
            await session.flush()
            stats["groups"] += 1
            print(f"  Created Group: {group.name}")

            for q_order, question_text in enumerate(group_data["questions"], start=1):
                # Create Question
                question = Question(
                    id=uuid4(),
                    group_id=group.id,
                    text=question_text,
                    display_order=q_order,
                    weight=Decimal("1.0"),
                    is_critical=False,
                    is_active=True,
                )
                session.add(question)
                await session.flush()
                stats["questions"] += 1

                # Create YES option (score=1, no requirements)
                yes_option = QuestionOption(
                    id=uuid4(),
                    question_id=question.id,
                    option_type=OptionType.YES,
                    score=1,
                    require_comment=False,
                    require_image=False,
                    comment_min_len=0,
                    max_images=1,  # Minimum allowed by constraint
                    image_max_mb=1,  # Minimum allowed by constraint
                )
                session.add(yes_option)
                stats["options"] += 1

                # Create NO option (score=0, requires comment)
                no_option = QuestionOption(
                    id=uuid4(),
                    question_id=question.id,
                    option_type=OptionType.NO,
                    score=0,
                    require_comment=True,
                    require_image=False,
                    comment_min_len=10,
                    max_images=3,
                    image_max_mb=5,
                )
                session.add(no_option)
                stats["options"] += 1

            print(f"    Created {len(group_data['questions'])} questions")

    await session.commit()
    return stats


async def main():
    """Main entry point for seeding."""
    print("Starting question seed...")
    print("=" * 50)

    async with async_session_factory() as session:
        stats = await seed_questions(session)

    print("=" * 50)
    print("Seed completed!")
    print(f"  Types: {stats['types']}")
    print(f"  Groups: {stats['groups']}")
    print(f"  Questions: {stats['questions']}")
    print(f"  Options: {stats['options']}")


if __name__ == "__main__":
    asyncio.run(main())
